<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Image Blacklist Admin</title>
  <style>
    body { font-family: sans-serif; background: #f9f9f9; padding: 20px; }
    #admin-ui { display: none; }
    .blacklist-item {
      background: #fff; border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; border-radius: 5px;
    }
    .blacklist-item img {
      max-width: 150px; max-height: 150px; display: block; margin-top: 5px; border-radius: 4px;
    }
    button { cursor: pointer; padding: 5px 10px; margin-top: 5px; }
    input[type="text"] { width: 80%; padding: 5px; }
  </style>
</head>
<body>
  <h1>Admin - Image Blacklist Manager</h1>

  <div id="password-screen">
    <p>Enter admin password:</p>
    <input type="password" id="admin-password" />
    <button id="enter-button">Enter</button>
    <p id="error-msg" style="color: red;"></p>
  </div>

  <div id="admin-ui">
    <button onclick="logout()">Logout</button>

    <h2>Blacklisted Images</h2>
    <div id="blacklist-container"></div>

    <h3>Add Image URL to Blacklist</h3>
    <input type="text" id="new-image-url" placeholder="Paste image URL here" />
    <button id="add-button">Add to Blacklist</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA6uktBRcEfxGFaVx97ujxVzI5_EbNuEEo",
      authDomain: "happyfeed-af48f.firebaseapp.com",
      projectId: "happyfeed-af48f",
      storageBucket: "happyfeed-af48f.appspot.com",
      messagingSenderId: "456897128438",
      appId: "1:456897128438:web:1cfc3fe338df22498549d7",
      databaseURL: "https://happyfeed-af48f-default-rtdb.firebaseio.com"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const ADMIN_PASSWORD = "24681012ear";

    const passwordScreen = document.getElementById("password-screen");
    const adminUI = document.getElementById("admin-ui");
    const errorMsg = document.getElementById("error-msg");
    const blacklistContainer = document.getElementById("blacklist-container");
    const addButton = document.getElementById("add-button");
    const newImageUrlInput = document.getElementById("new-image-url");

    document.getElementById("enter-button").addEventListener("click", checkPassword);
    addButton.addEventListener("click", addToBlacklist);

    let blacklistRef;

    function checkPassword() {
      const input = document.getElementById("admin-password").value;
      if (input === ADMIN_PASSWORD) {
        passwordScreen.style.display = "none";
        adminUI.style.display = "block";
        loadBlacklist();
      } else {
        errorMsg.textContent = "Incorrect password.";
      }
    }

    function logout() {
      adminUI.style.display = "none";
      passwordScreen.style.display = "block";
      document.getElementById("admin-password").value = "";
      errorMsg.textContent = "";
      blacklistContainer.innerHTML = "";
      if (blacklistRef) blacklistRef.off();
    }

    function loadBlacklist() {
      blacklistRef = db.ref("blacklistedImages");
      blacklistRef.on("value", snapshot => {
        const data = snapshot.val() || {};
        blacklistContainer.innerHTML = "";

        const entries = Object.entries(data);
        if (entries.length === 0) {
          blacklistContainer.innerHTML = "<p>No blacklisted images.</p>";
          return;
        }

        entries.forEach(([urlKey, val]) => {
          const div = document.createElement("div");
          div.className = "blacklist-item";

          div.innerHTML = `
            <a href="${urlKey}" target="_blank" rel="noopener noreferrer">${urlKey}</a><br>
            <img src="${urlKey}" alt="Blacklisted image" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0nMTAwJyBoZWlnaHQ9JzEwMCcgdmlld0JveD0nMCAwIDEwMCAxMDAnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zyc+PHJlY3Qgd2lkdGg9JzEwMCUnIGhlaWdodD0nMTAwJScgc3R5bGU9J2ZpbGw6I2ZmMDAwMDsnLz48dGV4dCB4PSc1MCUnIHk9JzUwJScgZm9udC1zaXplPScxMScgZm9udC1mYW1pbHk9J3NhbnMtc2VyaWYnIHRleHQtYW5jaG9yPSdtaWRkbGUnIGZpbGw9JyNmZmYnPkJsb2NrZWQ8L3RleHQ+PC9zdmc+';" />
            <br>
            <button onclick="removeFromBlacklist('${urlKey}')">Remove</button>
          `;
          blacklistContainer.appendChild(div);
        });
      });
    }

    function addToBlacklist() {
      const url = newImageUrlInput.value.trim();
      if (!url) {
        alert("Please enter a valid image URL.");
        return;
      }
      // Add to database as a key with value true
      db.ref(`blacklistedImages/${encodeURIComponent(url)}`).set(true)
        .then(() => {
          alert("Image URL added to blacklist.");
          newImageUrlInput.value = "";
        })
        .catch(err => alert("Error adding to blacklist: " + err.message));
    }

    function removeFromBlacklist(url) {
      db.ref(`blacklistedImages/${encodeURIComponent(url)}`).remove()
        .then(() => alert("Image URL removed from blacklist."))
        .catch(err => alert("Error removing from blacklist: " + err.message));
    }
  </script>
</body>
</html>
